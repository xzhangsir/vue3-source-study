<!DOCTYPE html>
<html lang="zh_CN">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <script src="../dist/runtime-dom.global.js"></script>
</head>

<body>
  <div id="app"></div>
  <script>

    let { createRenderer, h, render, reactive, Text, Fragment,
        ref, toRefs, onBeforeMount, onMounted, onBeforeUpdate, onUpdated, getCurrentInstance,
      createElementBlock: _createElementBlock, openBlock: _openBlock,
      topDisplayString: _toDisplayString, createElementVNode: _createElementVNode } = VueRuntimeDOM
    // setup  可以返回render函数或对象
/*        const VueComponent = {
         props:{
           address:String
         },
         setup(props){
           const name = ref("zx")
           const age = ref(18)
           setTimeout(()=>{
             age.value++
           },1000)
           return {
             name,
             age,
             address:props.address + "xian"
           }
         },
         render(){
           return h('h1',[this.name,this.age,this.address])
         }
       } */

/*     const VueComponent = {
      props: {
        address: String
      },
      setup(props) {
        const name = ref("zx")
        const age = ref(18)
        setTimeout(() => {
          age.value++
        }, 1000)

        return () => {
          return h('h1', [name.value, age.value, props.address])
        }
      },
    }

    render(h(VueComponent, { address: "diqu" }), app)
 */

/*  const VueComponent = {
    setup(props, { emit }) {
      return () => {
        return h("h1", { onClick: () => emit('xxx', 'ok') }, 'hello')
      }
    }
  }
  render(h(VueComponent, { onXxx: (val) => alert(val) }), app)
 */

//  插槽
/*  const MyCom = {
    render() {
      return h(Fragment, [
        h('div', this.$slots.header()),
        "center",
        h('div', this.$slots.footer())
      ])
    }
  }



  const VueComponent = {
    render() {
      // children 如果是对象说明是组件的插槽
      return h(MyCom, null, {
        header: () => h('p', 'header'),
        footer: () => h('p', 'footer')
      })
    }
  }

  render(h(VueComponent), app) */


   //  生命周期
/*     const useCounter = (count) => {
      const state = reactive({ count })
      const handleClick = () => {
        state.count++
      }
      onBeforeMount(() => {
        console.log("onBeforeMount", getCurrentInstance());
      })
      // onMounted(() => {
      //   console.log("onMounted");
      // })
      // onBeforeUpdate(() => {
      //   console.log("onBeforeUpdate");
      // })
      return {
        state,
        handleClick
      }
    }

    const VueComponent = {
      setup() {
        const { state, handleClick } = useCounter(1)
         onBeforeMount(()=>{
          console.log("onBeforeMount11");
        })
        //  onMounted(()=>{
        //   console.log("onMounted11");
        // })
        // onBeforeUpdate(()=>{
        //   console.log("onBeforeUpdate11");
        // })
        return {
          ...toRefs(state),
          handleClick
        }

      },
      render() {
        return h("p", { onClick: this.handleClick }, this.count.value)
      }
    }

    render(h(VueComponent), app)  */


      // 靶向更新
  
    // 模板编译优化 增添了patchFlag  来标识那些节点是动态的
    // block 来收集节点 为不稳定结构也创建block节点 实现blockTree做到靶向更新
    // 编译中的优化： 静态提升  属性的提升 和 虚拟节点的提升  函数的缓存 预先解析字符串
    // 模板的性能更好
        const VueComponent = {
          setup() {
            const state = reactive({ name: "zx", class: "abc" })

            setTimeout(() => {
              state.name = "eee"
              state.class = 'def'
            }, 1000)

            return {
              state
            }
          },
          render(_ctx) {
            let vnode = (_openBlock(), _createElementBlock("div", null, [
              _createElementVNode("h1", null, "hello"),
              _createElementVNode("span", { class: _ctx.state.class },
              _toDisplayString(_ctx.state.name), 1 /*TEXT*/),
            ]))
            console.log(vnode)
            return vnode
          }
        }

        render(h(VueComponent), app) 

  </script>


</body>

</html>